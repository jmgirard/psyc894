{
  "hash": "4a6a57a6d940ddc407328f966ac667cc",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat: \n  revealjs:\n    css: ../../styles.css\n    slide-number: true\n    show-slide-number: all\n    preview-links: false\n    progress: true\n    history: true\n    hash-type: number\n    theme: default\n    code-block-background: true\n    highlight-style: zenburn\n    code-link: false\n    code-copy: true\n    code-line-numbers: false\n    controls: true\n    pagetitle: \"Multilevel Modeling\"\n    author-meta: \"Jeffrey Girard\"\n    semester: \"Spring 2026\"\n    course: \"PSYC 894\"\n    lecture: \"02b\"\nexecute:\n  echo: true\n  eval: true\n  collapse: false\n  cache: false\n---\n\n::: {.my-title}\n# [Multilevel Modeling]{.blue}\nLinear Modeling Review (2/2)\n\n::: {.my-grey}\n[{{< meta semester >}} | CLAS | {{< meta course >}}]{}<br />\n[Jeffrey M. Girard | Lecture {{< meta lecture >}}]{}\n:::\n\n![](../../img/city-girl.svg){.absolute bottom=30 right=0 width=\"400\"}\n:::\n\n\n## Roadmap\n\n::: {.columns .pv4}\n::: {.column width=\"60%\"}\n1. Moderation\n  \n2. Assumptions\n\n3. Diagnostics\n\n:::\n\n::: {.column .tc .pv4 width=\"40%\"}\n{{< lif \"../../icons/map.json\" trigger=hover colors=secondary:#2a76dd class=rc >}}\n:::\n\n:::\n\n# R Setup\n\n## Load Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(c(\"easystats\", \"marginaleffects\", \"ggplot2\", \"qqplotr\"))\nlibrary(easystats)\nlibrary(ggplot2)\nlibrary(marginaleffects)\nlibrary(qqplotr)\n\n# Set up default plot theme\ntheme_set(theme_bw(base_size = 30))\n```\n:::\n\n\n:::{.fsmaller}\n#### Needs to be loaded\n- [easystats]{.b .blue} will provide most of our statistical functions\n- [ggplot2]{.b .blue} will provide the ability to customize our plots\n\n#### Needs to be installed\n- [marginaleffects]{.b .green} is called by easystats for estimation\n- [qqplotr]{.b .green} is called by easystats for certain diagnostics\n\n:::\n\n## Example Dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_codebook(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\npenguins (344 rows and 8 variables, 8 shown)\n\nID | Name        | Type        |  Missings |       Values |           N\n---+-------------+-------------+-----------+--------------+------------\n1  | species     | categorical |  0 (0.0%) |       Adelie | 152 (44.2%)\n   |             |             |           |    Chinstrap |  68 (19.8%)\n   |             |             |           |       Gentoo | 124 (36.0%)\n---+-------------+-------------+-----------+--------------+------------\n2  | island      | categorical |  0 (0.0%) |       Biscoe | 168 (48.8%)\n   |             |             |           |        Dream | 124 (36.0%)\n   |             |             |           |    Torgersen |  52 (15.1%)\n---+-------------+-------------+-----------+--------------+------------\n3  | bill_len    | numeric     |  2 (0.6%) | [32.1, 59.6] |         342\n---+-------------+-------------+-----------+--------------+------------\n4  | bill_dep    | numeric     |  2 (0.6%) | [13.1, 21.5] |         342\n---+-------------+-------------+-----------+--------------+------------\n5  | flipper_len | integer     |  2 (0.6%) |   [172, 231] |         342\n---+-------------+-------------+-----------+--------------+------------\n6  | body_mass   | integer     |  2 (0.6%) | [2700, 6300] |         342\n---+-------------+-------------+-----------+--------------+------------\n7  | sex         | categorical | 11 (3.2%) |       female | 165 (49.5%)\n   |             |             |           |         male | 168 (50.5%)\n---+-------------+-------------+-----------+--------------+------------\n8  | year        | integer     |  0 (0.0%) |         2007 | 110 (32.0%)\n   |             |             |           |         2008 | 114 (33.1%)\n   |             |             |           |         2009 | 120 (34.9%)\n-----------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n::: {.fsmaller}\n*Note that this dataset is already included with recent versions of R.*\n:::\n\n\n# Moderation\n\n## Moderation {.smaller}\n\n::: {.columns .pv4}\n::: {.column width=\"60%\"}\n-   We may want to know if the effect of one predictor [depends on]{.b .green} the value on another predictor\n\n::: {.fragment .mt1}\n-   To answer these, we can test [interaction effects]{.b .blue}\n    -   Interaction effects are just slopes for the [product]{.b .green} of two or more predictors\n    -   Centering continous predictors is helpful\n\n:::\n::: {.fragment .mt1}\n-   Types of bivariate moderation\n    +   Continuous-by-Continuous Moderation (CCM)\n    +   Continuous-by-Discrete Moderation (CDM)\n    +   Discrete-by-Discrete Moderation (DDM)\n    +   Higher-order (e.g., three-way) Moderation\n:::\n:::\n\n::: {.column .tc .pv5 width=\"40%\"}\n{{< lif \"../../icons/signpost.json\" trigger=hover colors=secondary:#2a76dd class=rc >}}\n:::\n:::\n\n# CCM\n\nContinuous-by-Continuous Moderation\n\n## CCM Equation\n\n#### Generic\n$$y_i = \\beta_0 + \\beta_1 x_{1i} + \\beta_2 x_{2i} + \\beta_3 (x_{1i} x_{2i}) + \\varepsilon_{i}$$\n\n#### Example\n$$\\text{MASS}_i = \\beta_0 + \\beta_1 \\text{FLEN}_{i} + \\beta_2 \\text{BDEP}_{i} + \\\\\n\\beta_3 \\text{FLEN}_i \\text{BDEP}_i + \\varepsilon_i$$\n\n## CCM Formula\n\n#### Generic\n:::{.tc}\n`y ~ 1 + x1 * x2`\n:::\n\n#### Example\n:::{.tc}\n`body_mass ~ 1 + flipper_len * bill_dep`\n:::\n\n## CCM Diagram {.nostretch}\n![](../../diagrams/cc_moderation_full.png){width=\"50%\"}\n\n## CCM Estimation\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_c <- center(penguins, select = c(\"flipper_len\", \"bill_dep\"))\nccm_fb <- lm(\n  formula = body_mass ~ 1 + flipper_len * bill_dep,\n  data = penguins_c\n)\n```\n:::\n\n\n:::{.pv4}\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(ccm_fb)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter              | Coefficient |    SE |             95% CI | t(338) |      p\n-----------------------------------------------------------------------------------\n(Intercept)            |     4062.79 | 29.56 | [4004.65, 4120.93] | 137.46 | < .001\nflipper len            |       48.63 |  1.82 | [  45.05,   52.22] |  26.71 | < .001\nbill dep               |       44.64 | 13.02 | [  19.04,   70.25] |   3.43 | < .001\nflipper len × bill dep |       -8.60 |  1.34 | [ -11.23,   -5.96] |  -6.41 | < .001\n```\n\n\n:::\n:::\n\n\n:::\n\n## CCM Interpretation {.smaller}\n\nAfter centering the flipper length and bill depth predictors, ...\n\n- **Intercept** $(\\beta_0=4063.8$, $p<.001)$<br />\nThe expected body mass for a penguin with average flipper length and bill depth.\n\n- **Flipper Length Simple Effect** $(\\beta_1=48.6$, $p<.001)$<br />\nThe expected change in body mass associated with an increase of 1mm flipper length,<br />*specifically for a penguin with average bill depth*.\n\n- **Bill Depth Simple Effect** $(\\beta_2=44.6$, $p<.001)$<br />\nThe expected change in body mass associated with an increase of 1mm bill depth,<br />*specifically for a penguin with average flipper length*.\n\n- **Flipper-Length-by-Bill-Depth Interaction Effect** $(\\beta_3=-8.6$, $p<.001)$<br />\nThe expected change in the slope of one predictor for an increase of 1 in the other.<br />\n*The negative sign here means the flipper length effect gets weaker as bills get deeper.*\n\n## CCM Visualization 1\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npred_ccmf <- estimate_relation(\n  model = ccm_fb, \n  by = c(\n    \"flipper_len\", \n    \"bill_dep = [quartiles]\"\n  ), \n  estimate = \"average\"\n)\n\nplot(pred_ccmf)\n```\n\n::: {.cell-output-display}\n![](b_Slides_files/figure-revealjs/unnamed-chunk-5-1.png){width=624}\n:::\n\n```{.r .cell-code}\n  labs(\n    x = \"Flipper Length\", \n    y = \"Body Mass\", \n    color = \"Bill Depth\", \n    fill = \"Bill Depth\"\n  ) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n:::\n\n\n## CCM Visualization 2\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npred_ccmb <- estimate_relation(\n  model = ccm_fb, \n  by = c(\n    \"bill_dep\", \n    \"flipper_len = [quartiles]\"\n  ), \n  estimate = \"average\"\n)\n\nplot(pred_ccmb) +\n  labs(\n    x = \"Bill Depth\", \n    y = \"Body Mass\", \n    color = \"Flipper Length\", \n    fill = \"Flipper Length\"\n  ) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](b_Slides_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n## CCM Simple Slopes 1\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestimate_slopes(\n  model = ccm_fb, \n  trend = \"flipper_len\", \n  by = \"bill_dep = [quartiles]\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimated Marginal Effects\n\nbill_dep | Slope |   SE |         95% CI | t(338) |      p\n----------------------------------------------------------\n-1.55    | 61.97 | 2.40 | [57.25, 66.69] |  25.84 | < .001\n0.15     | 47.35 | 1.88 | [43.65, 51.05] |  25.18 | < .001\n1.55     | 35.32 | 3.08 | [29.25, 41.38] |  11.45 | < .001\n\nMarginal effects estimated for flipper_len\nType of slope was dY/dX\n```\n\n\n:::\n:::\n\n\n## CCM Simple Slopes 2\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestimate_slopes(\n  model = ccm_fb, \n  trend = \"bill_dep\", \n  by = \"flipper_len = [quartiles]\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimated Marginal Effects\n\nflipper_len |  Slope |    SE |           95% CI | t(338) |      p\n-----------------------------------------------------------------\n-10.91      | 138.47 | 22.01 | [ 95.17, 181.77] |   6.29 | < .001\n-3.92       |  78.30 | 15.28 | [ 48.25, 108.34] |   5.13 | < .001\n12.09       | -59.25 | 17.90 | [-94.46, -24.03] |  -3.31 |  0.001\n\nMarginal effects estimated for bill_dep\nType of slope was dY/dX\n```\n\n\n:::\n:::\n\n\n# CDM\n\nContinuous-by-Discrete Moderation\n\n## CDM Equation {.smaller}\n\n#### Generic\n$$\n\\begin{aligned}\ny_i &= \\overbrace{(\\beta_0 + \\beta_2 D_{1i} + \\dots)}^{\\text{Group-Specific Intercept}}\n+ \\overbrace{(\\beta_1 + \\beta_3 D_{1i} + \\dots)}^{\\text{Group-Specific Slope}} \\cdot x_i \n+ \\varepsilon_i\n\\end{aligned}\n$$\n\n#### Example\n$$\n\\begin{aligned}\n\\text{MASS}_i &= (\\beta_0 + \\beta_2 \\text{CHIN}_{i} + \\beta_3 \\text{GENT}_i) \\\\\n&\\quad + (\\beta_1 + \\beta_4 \\text{CHIN}_{i} + \\beta_5 \\text{GENT}_i) \\cdot \\text{FLEN}_i\n+ \\varepsilon_i\n\\end{aligned}\n$$\n\n## CDM Formula\n\n#### Generic\n:::{.tc}\n`y ~ 1 + x * f`\n:::\n\n#### Example\n:::{.tc}\n`mass ~ 1 + flipper * species`\n:::\n\n## CDM Diagram {.nostretch}\n![](../../diagrams/cb_moderation_full.png){width=\"50%\"}\n\n## CDM Estimation\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_c <- center(penguins, select = \"flipper_len\")\ncdm_fs <- lm(\n  formula = body_mass ~ 1 + flipper_len * species, \n  data = penguins_c\n)\n```\n:::\n\n\n:::{.pv4}\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_parameters(cdm_fs) |> print(select = \"minimal\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nParameter                         | Coefficient |             95% CI |      p\n-----------------------------------------------------------------------------\n(Intercept)                       |     4060.55 | [3944.47, 4176.62] | < .001\nflipper len                       |       32.83 | [  23.73,   41.93] | < .001\nspecies [Chinstrap]               |     -151.42 | [-310.58,    7.73] | 0.062 \nspecies [Gentoo]                  |      126.66 | [ -85.98,  339.31] | 0.242 \nflipper len × species [Chinstrap] |        1.74 | [ -13.71,   17.19] | 0.825 \nflipper len × species [Gentoo]    |       21.79 | [   8.14,   35.44] | 0.002 \n```\n\n\n:::\n:::\n\n\n:::\n\n## CDM Interpretation 1 {.smaller}\n\nAfter centering the Flipper Length predictor and setting Adelie as reference, ...\n\n- **Intercept** $(\\beta_0=4060.6$, $p<.001)$<br />\nThe expected body mass for an Adelie penguin with average flipper length.\n\n- **Flipper Length Simple Effect** $(\\beta_1=32.8$, $p<.001)$<br />\nThe expected change in mass associated with an increase of 1mm flipper length,<br />*specifically for the reference group (Adelie)*.\n\n- **Chinstrap Simple Effect** $(\\beta_2=-151.4$, $p=.062)$<br />\nThe difference in expected mass between Chinstrap and Adelie penguins,<br />*specifically for penguins with average flipper length*.\n\n- **Gentoo Simple Effect** $(\\beta_3=126.7$, $p=.242)$<br />\nThe difference in expected mass between Gentoo and Adelie penguins,<br />*specifically for penguins with average flipper length*.\n\n## CDM Interpretation 2 {.smaller}\n- **Flipper-by-Chinstrap Interaction Effect** $(\\beta_4=1.7$, $p=.825)$<br />\nThe adjustment to the flipper slope for Chinstraps compared to Adelies.<br />\n*The flipper--mass relationship is not significantly different for Chinstraps and Adelies.*\n\n- **Flipper-by-Gentoo Interaction Effect** $(\\beta_5=21.8$, $p=.002)$<br />\nThe adjustment to the flipper slope for Gentoos compared to Adelies.<br />\n*The flipper--mass relationship is significantly steeper for Gentoos than for Adelies.*\n\n## CDM Visualization\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\npred_cdmf <- estimate_relation(\n  model = cdm_fs, \n  by = c(\n    \"flipper_len\", \n    \"species\"\n  ),\n  estimate = \"average\"\n)\nplot(pred_cdmf) +\n  labs(\n    x = \"Flipper Length\",\n    y = \"Body Mass\",\n    color = \"Species\",\n    fill = \"Species\"\n  ) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](b_Slides_files/figure-revealjs/unnamed-chunk-11-1.png){width=816}\n:::\n:::\n\n\n## CDM Simple Slopes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nestimate_slopes(\n  model = cdm_fs, \n  trend = \"flipper_len\", \n  by = \"species\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimated Marginal Effects\n\nspecies   | Slope |   SE |         95% CI | t(336) |      p\n-----------------------------------------------------------\nAdelie    | 32.83 | 4.63 | [23.73, 41.93] |   7.10 | < .001\nChinstrap | 34.57 | 6.33 | [22.11, 47.03] |   5.46 | < .001\nGentoo    | 54.62 | 5.17 | [44.46, 64.79] |  10.57 | < .001\n\nMarginal effects estimated for flipper_len\nType of slope was dY/dX\n```\n\n\n:::\n:::\n\n\n:::{.fsmaller}\n*Notice the Gentoo slope (54.6) is the Adelie slope (32.8) plus the interaction (21.8).*\n:::\n\n## A Formula Resource {.smaller}\n\n<table width=\"100%\">\n<tr>\n  <th>Formula</th>\n  <th colspan=7>Slopes Estimated</th>\n</tr>\n<tr>\n  <td width=\"30%\">`y ~ x`</td>\n  <td width=\"10%\">$x$</td>\n  <td width=\"10%\"></td>\n  <td width=\"10%\"></td>\n  <td width=\"10%\"></td>\n  <td width=\"10%\"></td>\n  <td width=\"10%\"></td>\n  <td width=\"10%\"></td>\n</tr>\n<tr>\n  <td>`y ~ x + w`</td>\n  <td>$x$</td>\n  <td>$w$</td>\n  <td></td>\n  <td></td>\n  <td></td>\n  <td></td>\n  <td></td>\n</tr>\n<tr>\n  <td>`y ~ x * w`</td>\n  <td>$x$</td>\n  <td>$w$</td>\n  <td></td>\n  <td>$xw$</td>\n  <td></td>\n  <td></td>\n  <td></td>\n</tr>\n<tr>\n  <td>`y ~ x + w + z`</td>\n  <td>$x$</td>\n  <td>$w$</td>\n  <td>$z$</td>\n  <td></td>\n  <td></td>\n  <td></td>\n  <td></td>\n</tr>\n<tr>\n  <td>`y ~ x * w + z`</td>\n  <td>$x$</td>\n  <td>$w$</td>\n  <td>$z$</td>\n  <td>$xw$</td>\n  <td></td>\n  <td></td>\n  <td></td>\n</tr>\n<tr>\n  <td>`y ~ x * (w + z)`</td>\n  <td>$x$</td>\n  <td>$w$</td>\n  <td>$z$</td>\n  <td>$xw$</td>\n  <td>$xz$</td>\n  <td></td>\n  <td></td>\n</tr>\n<tr>\n  <td>`y ~ (x + w + z)^2`</td>\n  <td>$x$</td>\n  <td>$w$</td>\n  <td>$z$</td>\n  <td>$xw$</td>\n  <td>$xz$</td>\n  <td>$wz$</td>\n  <td></td>\n</tr>\n<tr>\n  <td>`y ~ x * w * z`</td>\n  <td>$x$</td>\n  <td>$w$</td>\n  <td>$z$</td>\n  <td>$xw$</td>\n  <td>$xz$</td>\n  <td>$wz$</td>\n  <td>$xwz$</td>\n</tr>\n</table>\n\n::: {.pv4 .f3}\nNote that predictors can be continuous or discrete, but if a discrete predictor has more than two levels, you will end up with additional slopes due to dummy coding. To represent $g$ groups, it will create $g-1$ dummy codes (with a slope for each).\n:::\n\n# Assumptions\n\n## Specification Assumptions {.smaller}\n\n- **Linearity in the Coefficients**\n    + The effect of each predictor is additive and proportional to its slope\n    + [Classic]{.safe}: $y_i = \\beta_0 + \\beta_1 x_{1i} + \\beta_2 x_{2i} + \\varepsilon_i$\n    + [Still Okay]{.safe}: $y_i = \\beta_0 + \\beta_1 x_i + \\beta_2 x_i^2 + \\varepsilon_i$\n    + [Not Okay]{.danger}: $y_i = \\beta_0 + \\beta_1 \\beta_2 x_i + \\varepsilon_i$\n    + [Not Okay]{.danger}: $y_i = \\beta_0 + e^{\\beta_1 x_i} + \\varepsilon_i$\n    \n- **No Multicollinearity**\n    + None of the predictors are fully redundant with one another\n\n\n## Residual Assumptions {.smaller}\n\n$$\n\\begin{align}\ny_i &= \\beta_0 + \\beta_1 x_{1i} + \\dots + \\varepsilon_i \\\\\n\\varepsilon_i &\\overset{\\text{iid}}{\\sim}\\text{Normal}(0, \\sigma^2)\n\\end{align}\n$$\n\n- The residuals $(\\varepsilon_i)$ are assumed to be \"IID\"\n    + <u>**I**</u>ndependent of one another (no clustering or autocorrelation)\n        + *Relaxing this assumption is the main goal of multilevel modeling*\n    + <u>**I**</u>dentically <u>**D**</u>istributed \n        + Across the line, the residuals form a normal distribution (normality)\n        + Across the line, the residuals have a constant mean of $0$ (zero conditional mean)\n        + Across the line, the resiudals have a constant variance of $\\sigma^2$ (homoskedasticity)\n\n## Additional Assumptions\n\n- **For causal modeling especially...**\n    + All relevant predictors (confounders) are included\n    + No \"backdoor\" causal paths (colliders) are included\n    + All predictors are fully reliable (no measurement error)\n    + The residuals are independent of all the predictors\n    + The predictors are not influenced by the outcome\n",
    "supporting": [
      "b_Slides_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}